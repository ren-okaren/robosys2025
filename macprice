#!/usr/bin/env python3
# SPDX-FileCopyrightText: 2025 Ren Okaren
# SPDX-License-Identifier: BSD-3-Clause

import re
import sys


KCAL_TABLE = {
    # 主食・麺
    "白ごはん(茶碗1杯)": 240,
    "食パン(6枚切り1枚)": 160,
    "おにぎり": 180,
    "カレーライス": 850,
    "牛丼": 700,
    "親子丼": 700,
    "カツ丼": 900,
    "チャーハン": 750,
    "オムライス": 750,
    "焼きそば": 650,
    "ラーメン": 800,
    "味噌ラーメン": 900,
    "うどん": 420,
    "そば": 350,
    "パスタ": 700,
    "ペペロンチーノ": 650,
    "ミートソース": 750,

    # おかず
    "唐揚げ(5個)": 450,
    "生姜焼き定食": 900,
    "とんかつ定食": 1000,
    "ハンバーグ": 550,
    "焼肉定食": 1000,
    "サラダ": 120,
    "シーザーサラダ": 250,
    "味噌汁": 40,

    # 軽食・おやつ
    "サンドイッチ": 350,
    "プロテインバー": 200,
    "ヨーグルト": 120,
    "ポテチ": 330,
    "チョコレート": 280,

    # 飲み物
    "カフェラテ": 140,
    "ブラックコーヒー": 5,
    "オレンジジュース": 110,

    # 果物
    "りんご": 95,
    "バナナ": 105,
}

# 数値kcalの直接入力
NUM_KCAL_RE = re.compile(r"^\s*(\d+(?:\.\d+)?)\s*(?:kcal|KCAL)?\s*$")

# 数量
MULT_TAIL_RE = re.compile(r"^\s*(.+?)\s*[*x×]\s*(\d+)\s*$")
MULT_HEAD_RE = re.compile(r"^\s*(\d+)\s*[*x×]\s*(.+?)\s*$")


def eprint(msg: str) -> None:
    print(msg, file=sys.stderr)


def parse_item_and_multiplier(token: str) -> tuple[str, int]:
    t = token.strip()
    if not t:
        raise ValueError("empty token")

    m = MULT_TAIL_RE.match(t)
    if m:
        return m.group(1).strip(), int(m.group(2))

    m = MULT_HEAD_RE.match(t)
    if m:
        return m.group(2).strip(), int(m.group(1))

    return t, 1


def kcal_of_one(item: str) -> int:
    m = NUM_KCAL_RE.match(item)
    if m:
        v = float(m.group(1))
        if v < 0:
            raise ValueError("negative kcal")
        return int(round(v))

    if item in KCAL_TABLE:
        return int(KCAL_TABLE[item])

    raise KeyError(item)


def main() -> int:
    if len(sys.argv) >= 2 and sys.argv[1] == "--list":
        for k, v in sorted(KCAL_TABLE.items()):
            print(f"{k}\t{v}")
        return 0

    raw = sys.stdin.read()
    raw = raw.replace("、", ",").strip()
    if not raw:
        eprint("ERROR: empty input")
        return 1

    lines = [ln.strip() for ln in raw.splitlines() if ln.strip()]
    if len(lines) != 1:
        eprint("ERROR: please provide exactly one non-empty line")
        return 1

    tokens = [t.strip() for t in lines[0].split(",") if t.strip()]
    if not tokens:
        eprint("ERROR: empty input")
        return 1

    total = 0
    for tok in tokens:
        try:
            item, mult = parse_item_and_multiplier(tok)
            if mult <= 0:
                eprint(f"ERROR: invalid multiplier: {tok}")
                return 1
            total += kcal_of_one(item) * mult
        except KeyError:
            eprint(f"ERROR: unknown item: {tok}")
            return 1
        except ValueError:
            eprint(f"ERROR: invalid kcal: {tok}")
            return 1

    print(total)
    return 0


if __name__ == "__main__":
    raise SystemExit(main())
EOF

